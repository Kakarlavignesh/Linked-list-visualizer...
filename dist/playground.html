<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Playground | LLMaster</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;600;700&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="dark-mode">
    <header>
        <nav class="container">
            <div class="logo">
                <a href="index.html" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-link"></i>
                    <span>LL<span>Master</span></span>
                </a>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="visualizer.html">Visualizer</a></li>
                <li><a href="playground.html" class="active btn-primary">Playground</a></li>
            </ul>
        </nav>
    </header>

    <div class="split-screen">
        <!-- Left Pane: Editor -->
        <div class="editor-pane">
            <div class="pane-header">
                <div class="title"><i class="fas fa-code"></i> Live Editor (JavaScript)</div>
                <button onclick="runCode()" class="btn-run">Run Code</button>
            </div>
            <div class="editor-content">
                <div class="line-numbers" id="line-numbers"></div>
                <textarea id="code-input" spellcheck="false" oninput="updateLineNumbers()">
Node node1 = new Node("A");
Node node2 = new Node("B");
node1.next = node2;
Node node3 = new Node("D");
node2.next = node3;</textarea>
            </div>
        </div>

        <!-- Right Pane: Visualization Preview -->
        <div class="viz-pane">
            <div class="pane-header">
                <div class="title"><i class="fas fa-network-wired"></i> Visualization Preview</div>
                <select id="list-type-select" onchange="runCode()">
                    <option value="singly">Singly Linked List</option>
                    <option value="doubly">Doubly Linked List</option>
                    <option value="circular">Circular Linked List</option>
                </select>
            </div>
            <div class="viz-container-main">
                <div id="main-viz" class="visualizer-container">
                    <div class="empty-msg">List is empty. Add a node to start!</div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/linked-list.js"></script>
    <script src="js/visualizer.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            updateLineNumbers();
            setTimeout(runCode, 100);
        });

        function updateLineNumbers() {
            const textarea = document.getElementById('code-input');
            const lineNumbers = document.getElementById('line-numbers');
            const lines = textarea.value.split('\n').length;
            lineNumbers.innerHTML = Array.from({ length: lines }, (_, i) => i + 1).join('<br>');
        }

        class MockNode {
            constructor(value) {
                this.value = value;
                this.next = null;
                this.prev = null;
            }
        }

        function runCode() {
            const code = document.getElementById('code-input').value;
            const lines = code.split('\n');
            const selectedType = document.getElementById('list-type-select').value;
            const viz = new Visualizer('main-viz', selectedType);

            const nodesMap = {};
            const allNodes = [];

            try {
                // Pass 1: Identify all node creations (allocations)
                lines.forEach(line => {
                    line = line.trim();
                    if (!line || line.startsWith('//')) return;

                    const nodeMatch = line.match(/(?:Node\s+)?([a-zA-Z_$][\w_$]*)\s*=\s*(?:new\s+Node)?\s*\(\s*(['"]?)(.*?)\2\s*\);?/i);
                    if (nodeMatch) {
                        const name = nodeMatch[1];
                        const val = nodeMatch[3];
                        const newNode = new MockNode(val);
                        nodesMap[name] = newNode; // Maintain latest reference for linking
                        allNodes.push(newNode);   // Keep in master list for rendering
                    }
                });

                // Pass 2: Establish Pointers
                lines.forEach(line => {
                    line = line.trim();
                    if (!line || line.startsWith('//')) return;

                    const nextMatch = line.match(/([a-zA-Z_$][\w_$]*)\.next\s*=\s*([a-zA-Z_$][\w_$]*);?/);
                    if (nextMatch) {
                        const from = nextMatch[1];
                        const to = nextMatch[2];
                        if (nodesMap[from] && nodesMap[to]) {
                            nodesMap[from].next = nodesMap[to];
                        }
                    }

                    const prevMatch = line.match(/([a-zA-Z_$][\w_$]*)\.prev\s*=\s*([a-zA-Z_$][\w_$]*);?/);
                    if (prevMatch) {
                        const from = prevMatch[1];
                        const to = prevMatch[2];
                        if (nodesMap[from] && nodesMap[to]) {
                            nodesMap[from].prev = nodesMap[to];
                        }
                    }
                });

                // Final Render: All allocated nodes, regardless of variable reuse
                if (allNodes.length > 0) {
                    viz.renderAll(allNodes);
                } else {
                    viz.render({ head: null, size: 0 });
                }
            } catch (e) {
                console.error("Parser Error:", e);
            }
        }
    </script>

    <style>
        :root {
            --bg-dark: #0a0f1d;
            --editor-bg: #0d1117;
            --pane-header-bg: #161b22;
            --border-clr: #30363d;
            --header-height: 60px;
        }

        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            background: var(--bg-dark);
            color: #fff;
            font-family: 'Inter', sans-serif;
        }

        header {
            height: var(--header-height);
            border-bottom: 1px solid var(--border-clr);
            background: #161b22;
        }

        .split-screen {
            display: flex;
            height: calc(100vh - var(--header-height));
        }

        .editor-pane,
        .viz-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .editor-pane {
            border-right: 1px solid var(--border-clr);
        }

        .pane-header {
            background: var(--pane-header-bg);
            padding: 0.75rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-clr);
            min-height: 50px;
        }

        .pane-header .title {
            font-size: 0.85rem;
            font-weight: 600;
            color: #c9d1d9;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-run {
            background: #6366f1;
            color: #fff;
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .btn-run:hover {
            background: #4f46e5;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.4);
        }

        #list-type-select {
            background: #21262d;
            color: #c9d1d9;
            border: 1px solid var(--border-clr);
            border-radius: 4px;
            padding: 0.3rem 0.5rem;
            font-size: 0.75rem;
            outline: none;
        }

        .editor-content {
            flex: 1;
            display: flex;
            background: var(--editor-bg);
            overflow: hidden;
        }

        .line-numbers {
            background: #0d1117;
            color: #484f58;
            padding: 1.5rem 0.5rem 1.5rem 1rem;
            text-align: right;
            border-right: 1px solid var(--border-clr);
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
            user-select: none;
            min-width: 40px;
        }

        #code-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #e6edf3;
            padding: 1.5rem;
            resize: both;
            outline: none;
            font-family: 'Fira Code', monospace;
            font-size: 0.95rem;
            line-height: 1.6;
            overflow: auto;
            min-width: 100px;
        }

        .viz-container-main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #0a0f1d;
            padding: 2rem;
            overflow: auto;
        }

        .visualizer-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }

        @media (max-width: 900px) {
            .split-screen {
                flex-direction: column;
            }

            .editor-pane {
                border-right: none;
                border-bottom: 1px solid var(--border-clr);
                height: 50%;
            }
        }

        .visual-node {
            background: #161b22 !important;
            border: 2px solid #30363d !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5) !important;
            min-width: 120px !important;
        }

        .node-data {
            background: transparent !important;
            color: #fff !important;
            padding: 1rem !important;
            font-size: 1.4rem !important;
        }

        .node-ptr {
            background: #21262d !important;
            color: #58a6ff !important;
            font-weight: 600 !important;
            letter-spacing: 1px !important;
        }

        .visual-arrow {
            color: #58a6ff !important;
        }
    </style>
</body>

</html>