<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLMaster | AI Multi-Language Visualizer</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;600;700&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.23.0/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
</head>

<body class="dark-mode premium-layout">
    <header>
        <nav class="container">
            <a href="index.html" class="btn-back">
                <i class="fas fa-arrow-left"></i> Back
            </a>
            <div class="logo">
                <a href="index.html" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-link"></i>
                    <span>LL<span>Master</span></span>
                </a>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="visualizer.html" class="active">Visualizer</a></li>
            </ul>
        </nav>
    </header>

    <div class="app-main">
        <div class="main-content">
            <div class="split-screen" style="flex: 1;">

                <!-- Editor Pane -->
                <div class="workspace-pane editor-pane">
                    <div class="pane-header lang-header-main">
                        <div class="header-tools">
                            <i class="fas fa-code-branch" style="font-size: 1.2rem; color: #6366f1;"></i>
                            <div class="custom-dropdown" id="lang-dropdown">
                                <div class="dropdown-trigger" onclick="toggleDropdown('lang-options')">
                                    <span id="current-lang">JavaScript (JS)</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="dropdown-options" id="lang-options">
                                    <div onclick="setLanguage('javascript', 'JavaScript (JS)')">JavaScript (JS)</div>
                                    <div onclick="setLanguage('python', 'Python (Py)')">Python (Py)</div>
                                    <div onclick="setLanguage('java', 'Java (OOP)')">Java (OOP)</div>
                                    <div onclick="setLanguage('cpp', 'C++ (Pointers)')">C++ (Pointers)</div>
                                    <div onclick="setLanguage('c', 'C (Legacy)')">C (Legacy)</div>
                                </div>
                            </div>

                            <div class="custom-dropdown" id="ex-dropdown">
                                <div class="dropdown-trigger" onclick="toggleDropdown('ex-options')"
                                    style="background: #2d333b; border-color: #30363d; box-shadow: none;">
                                    <span id="current-ex">Load Pattern...</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="dropdown-options" id="ex-options">
                                    <div onclick="loadExampleV2('create')">Basic Creation</div>
                                    <div onclick="loadExampleV2('reverse')">Reverse Logic</div>
                                    <div onclick="loadExampleV2('cycle')">Cycle/Loop</div>
                                </div>
                            </div>
                        </div>
                        <div class="header-actions" style="display: flex; gap: 10px;">
                            <button onclick="animateCode()" class="btn-animate"
                                style="background: #10b981; color: white; border: none; padding: 8px 20px; border-radius: 6px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease;"><i
                                    class="fas fa-play"></i> Animate</button>
                            <button onclick="runCode()" class="btn-run-pro"><i class="fas fa-bolt"></i> RUN</button>
                        </div>
                    </div>
                    <div id="editor" class="editor-content"></div>
                    <div class="editor-footer-status">
                        <div id="editor-status"><i class="fas fa-check"></i> System Ready</div>
                        <button class="ai-fix-btn" onclick="openAIChat()"><i class="fas fa-robot"></i> AI
                            DEBUGGER</button>
                    </div>
                </div>

                <!-- Visualizer Pane -->
                <div class="workspace-pane viz-pane">
                    <div class="pane-header">
                        <div class="title"><i class="fas fa-microchip"></i> Visual Output Machine</div>
                        <div class="viz-meta">
                            <span id="node-count-badge" class="node-badge">0 Nodes Found</span>
                        </div>
                    </div>
                    <div class="viz-container-main" id="viz-container">
                        <div id="empty-state" class="empty-state-msg">
                            <div class="pulse-icon"><i class="fas fa-plus-circle"></i></div>
                            <h3>Waiting for Node Definitions</h3>
                            <p>Write your code or load an example above.<br>
                                The visualizer will update automatically.</p>
                        </div>
                        <div id="viz-wrapper">
                            <!-- Visualizer.js will render here -->
                        </div>
                    </div>
                    <div class="viz-status-bar">
                        <div id="status-text">Parsing Logic...</div>
                        <div class="backend-label">BACKEND: ONLINE</div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- AI CHAT MODAL -->
    <div id="ai-chat-modal" class="ai-modal">
        <div class="ai-modal-content">
            <div class="ai-modal-header">
                <h3><i class="fas fa-robot"></i> LLMaster AI Debugger</h3>
                <button onclick="closeAIChat()" class="close-btn">&times;</button>
            </div>
            <div class="ai-chat-body" id="ai-messages">
                <div class="ai-msg bot">Hi! I can fix logical errors (like wrong property names) and cross-language
                    syntax issues. Type "fix my code" to begin.</div>
            </div>
            <div class="ai-chat-footer">
                <input type="text" id="ai-input" placeholder="e.g. 'fix my code'..." onkeypress="handleAIPress(event)">
                <button onclick="askAI()" class="btn-ai-send">FIX ERROR</button>
            </div>
        </div>
    </div>

    <!-- Multi-Language Logic & AI Integration -->
    <script src="js/linked-list.js"></script>
    <script src="js/visualizer.js"></script>
    <script>
        let editor, viz;
        let selectedLang = 'javascript';

        const langTemplates = {
            javascript: `let n1 = new Node(10);\nlet n2 = new Node(20);\nn1.next = n2;`,
            python: `a = Node("Apple")\nb = Node("Banana")\na.next = b`,
            java: `ListNode n1 = new ListNode(1);\nListNode n2 = new ListNode(2);\nn1.next = n2;`,
            cpp: `Node* a = new Node(100);\nNode* b = new Node(200);\na->next = b;`,
            c: `struct Node* a = createNode(1);\nstruct Node* b = createNode(2);\na->next = b;`
        };

        const examples = {
            create: langTemplates,
            reverse: {
                javascript: `let n1 = new Node(1);\nlet n2 = new Node(2);\nlet n3 = new Node(3);\n// Physically reverse links\nn3.next = n2;\nn2.next = n1;`,
                python: `a = Node(1)\nb = Node(2)\nc = Node(3)\n# Reverse pointers\nc.next = b\nb.next = a`,
                java: `ListNode n1 = new ListNode(1);\nListNode n2 = new ListNode(2);\nListNode n3 = new ListNode(3);\nn3.next = n2;\nn2.next = n1;`,
                cpp: `Node* a = new Node(1);\nNode* b = new Node(2);\nNode* c = new Node(3);\nc->next = b;\nb->next = a;`,
                c: `struct Node* a = createNode(1);\nstruct Node* b = createNode(2);\nstruct Node* c = createNode(3);\nc->next = b;\nb->next = a;`
            },
            cycle: {
                javascript: `let a = new Node(10);\nlet b = new Node(20);\nlet c = new Node(30);\na.next = b;\nb.next = c;\nc.next = a; // Loop!`,
                python: `a = Node(10)\nb = Node(20)\nc = Node(30)\na.next = b\nb.next = c\nc.next = a`,
                java: `ListNode n1 = new ListNode(10);\nListNode n2 = new ListNode(20);\nListNode n3 = new ListNode(30);\nn1.next = n2;\nn2.next = n3;\nn3.next = n1;`,
                cpp: `Node* a = new Node(10);\nNode* b = new Node(20);\nNode* c = new Node(30);\na->next = b;\nb->next = c;\nc->next = a;`,
                c: `struct Node* a = createNode(10);\nstruct Node* b = createNode(20);\nstruct Node* c = createNode(30);\na->next = b;\nb->next = c;\nc->next = a;`
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            initAce();
            viz = new Visualizer('viz-container');
            // Force first render
            setLanguage('javascript', 'JavaScript (JS)');
        });

        function initAce() {
            editor = ace.edit("editor");
            editor.setTheme("ace/theme/tomorrow_night_eighties");
            editor.session.setMode("ace/mode/javascript");
            editor.setShowPrintMargin(false);
            editor.setOptions({ fontSize: "14px", useSoftTabs: true, fontFamily: "'Fira Code', monospace" });
            editor.on("change", () => setTimeout(runCode, 300));
        }

        /** CUSTOM DROPDOWN LOGIC **/
        function toggleDropdown(id) {
            const options = document.getElementById(id);
            const all = document.querySelectorAll('.dropdown-options');
            all.forEach(a => { if (a.id !== id) a.classList.remove('show'); });
            options.classList.toggle('show');
        }

        window.onclick = function (event) {
            if (!event.target.closest('.custom-dropdown')) {
                document.querySelectorAll('.dropdown-options').forEach(d => d.classList.remove('show'));
            }
        }

        function setLanguage(val, label) {
            selectedLang = val;
            document.getElementById('current-lang').innerText = label;
            document.getElementById('lang-options').classList.remove('show');

            const modes = { python: "python", java: "java", cpp: "c_cpp", c: "c_cpp", javascript: "javascript" };
            editor.session.setMode("ace/mode/" + modes[val]);
            editor.setValue(langTemplates[val], -1);
            runCode();
        }

        function loadExampleV2(key) {
            document.getElementById('current-ex').innerText = key.toUpperCase();
            document.getElementById('ex-options').classList.remove('show');
            const code = examples[key][selectedLang];
            editor.setValue(code, -1);
            runCode();
        }

        async function animateCode() {
            const code = editor.getValue();
            const lines = code.split('\n');
            const nodesMap = {};
            const creationOrder = [];
            const Range = ace.require('ace/range').Range;
            let currentMarker = null;

            const createPattern = /(?:(?:let|var|const|Node\*?|struct\s+Node\*?|ListNode\*?)\s+)?([a-zA-Z_$][\w0-9_$]*)\s*=\s*(?:new\s+)?(?:Node|ListNode|createNode)\s*\(\s*['"]?(.*?)['"]?\s*\)/i;
            const linkPattern = /([a-zA-Z_$][\w0-9_$]*)(?:\.|\->)([a-zA-Z0-9_$]+)\s*=\s*([a-zA-Z_$][\w0-9_$]*)/i;

            // Clear visualizer first
            viz.renderAll([]);
            document.getElementById('empty-state').style.display = 'none';
            document.getElementById('viz-wrapper').style.display = 'block';

            for (let i = 0; i < lines.length; i++) {
                let line = lines[i].trim();

                // Highlight current line
                if (currentMarker !== null) {
                    editor.session.removeMarker(currentMarker);
                }
                currentMarker = editor.session.addMarker(new Range(i, 0, i, 1), "ace_step_highlight", "fullLine");
                editor.scrollToLine(i, true, true, function () { });

                if (!line) {
                    await new Promise(r => setTimeout(r, 100));
                    continue;
                }

                const cMatch = line.match(createPattern);
                const lMatch = line.match(linkPattern);

                if (cMatch) {
                    const name = cMatch[1], val = cMatch[2];
                    const node = { value: val, next: null, prev: null, name: name };
                    nodesMap[name] = node;
                    creationOrder.push(node);

                    document.getElementById('editor-status').innerHTML = `<i class="fas fa-spinner fa-spin"></i> Creating Node <b>${name}</b>...`;
                    viz.renderAll(creationOrder);
                    await new Promise(r => setTimeout(r, 1000));
                } else if (lMatch) {
                    const from = lMatch[1], prop = lMatch[2], to = lMatch[3];
                    if (nodesMap[from] && nodesMap[to]) {
                        nodesMap[from][prop] = nodesMap[to];
                        document.getElementById('editor-status').innerHTML = `<i class="fas fa-link"></i> Linking <b>${from}</b> to <b>${to}</b>...`;
                        viz.renderAll(creationOrder);
                        await new Promise(r => setTimeout(r, 1000));
                    }
                } else {
                    await new Promise(r => setTimeout(r, 300));
                }
            }

            if (currentMarker !== null) {
                editor.session.removeMarker(currentMarker);
            }
            document.getElementById('editor-status').innerHTML = `<i class="fas fa-check-double" style="color:#10b981"></i> Animation complete.`;
            runCode(); // Final run to ensure everything is synced
        }

        function runCode() {
            const code = editor.getValue();
            const lines = code.split('\n');
            const nodesMap = {};
            const creationOrder = [];
            let annotations = [];

            const createPattern = /(?:(?:let|var|const|Node\*?|struct\s+Node\*?|ListNode\*?)\s+)?([a-zA-Z_$][\w0-9_$]*)\s*=\s*(?:new\s+)?(?:Node|ListNode|createNode)\s*\(\s*['"]?(.*?)['"]?\s*\)/i;
            const linkPattern = /([a-zA-Z_$][\w0-9_$]*)(?:\.|\->)([a-zA-Z0-9_$]+)\s*=\s*([a-zA-Z_$][\w0-9_$]*)/i;

            lines.forEach((line, index) => {
                line = line.trim();
                const cMatch = line.match(createPattern);
                const lMatch = line.match(linkPattern);

                if (cMatch) {
                    const name = cMatch[1], val = cMatch[2];
                    if (nodesMap[name]) {
                        annotations.push({ row: index, column: 0, text: `Duplicate node name '${name}' detected. Each node must have a unique identifier.`, type: "error" });
                    }
                    const node = { value: val, next: null, prev: null, name: name };
                    nodesMap[name] = node;
                    creationOrder.push(node);
                } else if (lMatch) {
                    const from = lMatch[1], prop = lMatch[2], to = lMatch[3];
                    if (nodesMap[from] && nodesMap[to]) {
                        if (prop === 'next' || prop === 'prev') {
                            nodesMap[from][prop] = nodesMap[to];
                        } else {
                            annotations.push({ row: index, column: 0, text: `Invalid link property '${prop}'. Use 'next' or 'prev'.`, type: "error" });
                        }
                    } else {
                        annotations.push({ row: index, column: 0, text: `Undefined variable '${!nodesMap[from] ? from : to}'.`, type: "error" });
                    }
                }
            });

            editor.getSession().setAnnotations(annotations);
            document.getElementById('editor-status').innerHTML = annotations.length > 0 ? `<i class="fas fa-times-circle" style="color:#ff7b72"></i> Errors detected.` : `<i class="fas fa-check" style="color:#10b981"></i> Code valid.`;

            const emptyEl = document.getElementById('empty-state');
            const wrapper = document.getElementById('viz-wrapper');
            if (creationOrder.length > 0) {
                emptyEl.style.display = 'none'; wrapper.style.display = 'block';
                viz.renderAll(creationOrder);
            } else {
                emptyEl.style.display = 'block'; wrapper.style.display = 'none';
                viz.init();
            }
            document.getElementById('node-count-badge').innerText = `${creationOrder.length} Nodes Found`;
        }

        function askAI() {
            const input = document.getElementById('ai-input').value;
            const messages = document.getElementById('ai-messages');
            if (!input) return;

            messages.innerHTML += `<div class="ai-msg user">${input}</div>`;
            document.getElementById('ai-input').value = '';

            setTimeout(() => {
                let code = editor.getValue();
                let originalCode = code;
                const currentLines = code.split('\n');
                let fixes = [];
                let changedAny = false;

                // Track defined and used nodes
                const definedNodes = new Set();
                const usedNodes = new Set();

                // 1. Precise Node Declaration & Duplicate Detection
                // Regex for actual node creation: Type? Name = New? Node(val)
                const nodeDeclRegex = /^\s*(?:(?:let|var|const|Node\*?|struct\s+Node\*?|ListNode\*?)\s+)?([a-zA-Z_$][\w0-9_$]*)\s*=\s*(?:new\s+)?(?:Node|ListNode|createNode)/i;

                for (let i = 0; i < currentLines.length; i++) {
                    const line = currentLines[i].trim();
                    const dMatch = line.match(nodeDeclRegex);
                    if (dMatch) {
                        const name = dMatch[1];
                        if (definedNodes.has(name)) {
                            let nextName = name + "_fixed";
                            let count = 1;
                            while (definedNodes.has(nextName)) { nextName = name + "_" + count; count++; }
                            currentLines[i] = currentLines[i].replace(name, nextName);
                            definedNodes.add(nextName);
                            changedAny = true;
                            fixes.push(`Duplicate node '${name}' renamed to '${nextName}'`);
                        } else {
                            definedNodes.add(name);
                        }
                    }

                    // Collect used nodes from link assignments: n1.next = n2
                    const lMatch = line.match(/([a-zA-Z_$][\w0-9_$]*)(?:\.|\->)(?:next|prev)\s*=\s*([a-zA-Z_$][\w0-9_$]*)/i);
                    if (lMatch) {
                        usedNodes.add(lMatch[1]);
                        usedNodes.add(lMatch[2]);
                    }
                }

                // 2. Fix mangled property links (e.g., next_fixed -> next)
                for (let i = 0; i < currentLines.length; i++) {
                    const mangled = /(?:\.|\->)(next|prev)_[a-zA-Z0-9_$]+/g;
                    if (mangled.test(currentLines[i])) {
                        currentLines[i] = currentLines[i].replace(mangled, (match, prop) => {
                            changedAny = true;
                            fixes.push(`Corrected mangled property link back to '.${prop}'`);
                            return (currentLines[i].includes('->') ? '->' : '.') + prop;
                        });
                    }
                }

                if (changedAny) code = currentLines.join('\n');

                // 3. Language Fixes (JS to Java)
                if (selectedLang === 'java' && code.includes('let ')) {
                    const old = code;
                    code = code.replace(/let /g, 'ListNode ');
                    if (code !== old) fixes.push("Converted JS 'let' to Java 'ListNode'");
                }

                // 4. Undefined Node Auto-Creation
                usedNodes.forEach(node => {
                    if (!definedNodes.has(node) && node !== 'null' && node !== 'nullptr') {
                        const decl = selectedLang === 'java' ? `ListNode ${node} = new ListNode(0);` :
                            selectedLang === 'python' ? `${node} = Node(0)` :
                                selectedLang === 'cpp' ? `Node* ${node} = new Node(0);` : `let ${node} = new Node(0);`;
                        code = decl + "\n" + code;
                        definedNodes.add(node);
                        fixes.push(`Auto-created missing node '${node}'`);
                    }
                });

                // 5. Logical Property Fixes (wrong names like .see)
                const wrongProps = /(?:\.|\->)(?!next|prev|val|value|data)([a-zA-Z0-9_$]+)\s*=/g;
                if (wrongProps.test(code)) {
                    code = code.replace(wrongProps, (match) => {
                        fixes.push("Redirected invalid property assignment to '.next'");
                        return match.includes('->') ? '->next =' : '.next =';
                    });
                }

                let responseMsg = "";
                if (fixes.length === 0) {
                    responseMsg = "I checked your code. Everything looks correct or no fixes could be applied automatically.";
                } else {
                    responseMsg = "<b>AI Fixes Applied:</b><br>" + [...new Set(fixes)].map(f => "â€¢ " + f).join('<br>');
                    editor.setValue(code, -1);
                    runCode();
                }

                messages.innerHTML += `<div class="ai-msg bot">${responseMsg}</div>`;
                messages.scrollTop = messages.scrollHeight;
            }, 800);
        }

        function openAIChat() { document.getElementById('ai-chat-modal').style.display = 'flex'; }
        function closeAIChat() { document.getElementById('ai-chat-modal').style.display = 'none'; }
        function handleAIPress(e) { if (e.key === 'Enter') askAI(); }
    </script>

    <style>
        :root {
            --accent: #6366f1;
            --bg-dark: #0a0f1d;
            --panel: #161b22;
            --border: #30363d;
        }

        body.premium-layout {
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: var(--bg-dark);
            color: #e6edf3;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            margin: 0;
        }

        /* FULL PAGE UTILIZATION */
        .app-main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .split-screen {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .header-tools {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--accent);
        }

        /* CUSTOM DROPDOWN STYLING (THEMED OPTIONS) */
        .custom-dropdown {
            position: relative;
            width: 155px;
        }

        .dropdown-trigger {
            background: #238636;
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 800;
            font-size: 0.75rem;
            box-shadow: 0 4px 15px rgba(35, 134, 54, 0.3);
            border: 1px solid #2ea043;
            white-space: nowrap;
        }

        .dropdown-options {
            position: absolute;
            top: calc(100% + 5px);
            left: 0;
            width: 100%;
            background: #1c2128;
            border: 1px solid var(--border);
            border-radius: 8px;
            z-index: 9999;
            display: none;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .dropdown-options.show {
            display: block;
            animation: slideDown 0.2s ease;
        }

        .dropdown-options div {
            padding: 10px 15px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: 0.2s;
            color: #c9d1d9;
            border-bottom: 1px solid var(--border);
        }

        .dropdown-options div:hover {
            background: var(--accent);
            color: white;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .workspace-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .editor-pane {
            border-right: 1px solid var(--border);
        }

        .viz-pane {
            flex: 1.6;
            background: #0d1117;
        }

        .pane-header {
            background: #161b22;
            padding: 12px 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 65px;
        }

        .editor-content {
            flex: 1;
        }

        .editor-footer-status {
            padding: 10px 1.5rem;
            background: #0d1117;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid var(--border);
        }

        .ai-fix-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 6px 15px;
            border-radius: 4px;
            font-weight: 800;
            cursor: pointer;
            font-size: 0.7rem;
        }

        .btn-run-pro {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            font-weight: 800;
            cursor: pointer;
        }

        .viz-container-main {
            flex: 1;
            position: relative;
            overflow: auto;
            background-image: radial-gradient(circle, #21262d 1px, transparent 1px);
            background-size: 40px 40px;
        }

        .empty-state-msg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #8b949e;
        }

        .pulse-icon {
            font-size: 3rem;
            color: var(--accent);
            animation: pulse 2s infinite;
        }

        .node-badge {
            background: var(--accent);
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            font-weight: 800;
            font-size: 0.75rem;
        }

        .viz-status-bar {
            padding: 12px 1.5rem;
            background: #161b22;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            color: #8b949e;
        }

        .ai-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .ai-modal-content {
            width: 450px;
            background: #161b22;
            border-radius: 12px;
            border: 1px solid var(--border);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.8);
        }

        .ai-modal-header {
            padding: 15px;
            background: #1c2128;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .ai-chat-body {
            flex: 1;
            height: 320px;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .ai-msg {
            padding: 10px 15px;
            border-radius: 10px;
            max-width: 85%;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .ai-msg.bot {
            background: #2d333b;
            align-self: flex-start;
        }

        .ai-msg.user {
            background: var(--accent);
            align-self: flex-end;
        }

        .ai-chat-footer {
            padding: 15px;
            background: #1c2128;
            display: flex;
            gap: 10px;
        }

        .ai-chat-footer input {
            flex: 1;
            background: #0d1117;
            border: 1px solid var(--border);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            outline: none;
        }

        .btn-ai-send {
            background: var(--accent);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            font-weight: 800;
            cursor: pointer;
        }

        .ace_step_highlight {
            position: absolute;
            background: rgba(16, 185, 129, 0.4);
            z-index: 20;
        }
    </style>
</body>

</html>